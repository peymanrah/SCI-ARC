# RLAN Core Ablation Configuration
# ==================================
# Tests the CORE NOVELTY of RLAN: DSC + MSRE (spatial anchoring + relative coords)
# 
# DISABLED MODULES:
#   - ContextEncoder: 4.2M params → 0 (uses raw features only)
#   - LCR: 403K params → 0 (no soft counting)
#   - SPH: 232K params → 0 (no symbolic predicates)
#
# ENABLED MODULES:
#   - DSC: 266K params (CORE - find spatial anchors)
#   - MSRE: 109K params (CORE - relative coordinate encoding)
#   - Encoder + Solver: Core pipeline
#
# This tests the hypothesis:
#   "Can RLAN solve tasks by reasoning in relative coordinates 
#    anchored to dynamically discovered features?"
#
# If this config works better than RLAN-Full, it proves the core novelty
# and suggests the other modules are hurting rather than helping.

model:
  type: "rlan"
  hidden_dim: 256
  num_colors: 10
  num_classes: 10
  max_grid_size: 30
  
  max_clues: 6
  num_predicates: 8
  num_solver_steps: 6
  
  use_act: true
  dropout: 0.1
  
  dsc_num_heads: 4
  lcr_num_heads: 4
  
  msre_encoding_dim: 32
  msre_num_freq: 8
  lcr_num_freq: 8
  
  # =============================================================
  # ABLATION: Core Novelty Only (DSC + MSRE)
  # =============================================================
  use_context_encoder: false  # DISABLED - test if bottleneck is hurting
  use_dsc: true               # ENABLED - CORE NOVELTY
  use_msre: true              # ENABLED - CORE NOVELTY
  use_lcr: false              # DISABLED - auxiliary
  use_sph: false              # DISABLED - auxiliary

training:
  max_epochs: 500
  
  batch_size: 85  # Can use more memory without ContextEncoder
  grad_accumulation_steps: 4
  
  learning_rate: 1.0e-4
  weight_decay: 0.1
  gradient_clip: 1.0
  
  temperature_start: 5.0
  temperature_end: 0.1
  
  # TRM-style loss (pure stablemax, no focal)
  loss_mode: 'stablemax'
  
  focal_gamma: 2.0
  focal_alpha: 0.25
  lambda_entropy: 0.1    # Force DSC to sharpen attention
  lambda_sparsity: 0.0   # Disabled - don't penalize clue usage
  lambda_predicate: 0.0  # Disabled - no SPH
  lambda_curriculum: 0.0
  lambda_deep_supervision: 0.3
  
  use_stablemax: true
  
  use_curriculum: false
  curriculum_stages: []
  
  optimizer: "adamw"
  beta1: 0.9
  beta2: 0.95
  scheduler: "onecycle"
  warmup_epochs: 20
  min_lr: 1.0e-6
  
  use_ema: true
  ema_decay: 0.999

data:
  train_path: "./data/arc-agi/data/training"
  eval_path: "./data/arc-agi/data/evaluation"
  
  max_grid_size: 30
  
  num_workers: 24
  pin_memory: true
  prefetch_factor: 4
  persistent_workers: true
  
  cache_samples: false
  
  augmentation:
    enabled: true
    rotation: true
    flip: true
    transpose: true
    color_permutation: true
    translational: true

evaluation:
  num_guesses: 2
  use_tta: true
  tta_rotations: [0, 90, 180, 270]
  tta_flips: [false, true]

logging:
  log_every: 1
  save_every: 25
  eval_every: 5
  keep_last_n: 5
  checkpoint_dir: "checkpoints/rlan_core_ablation"
  log_to_file: true
  track_augmentation: true
  
  use_wandb: false
  wandb_project: "rlan-arc"
  wandb_run_name: null

hardware:
  device: "cuda"
  seed: 42
  deterministic: false

device:
  use_cuda: true
  mixed_precision: true
  dtype: "bfloat16"
  compile: false
